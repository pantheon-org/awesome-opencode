name: Triage Tool Submission

on:
  issues:
    types: [opened, reopened]

permissions:
  issues: write
  contents: read

jobs:
  triage:
    runs-on: ubuntu-latest
    if: contains(github.event.issue.labels.*.name, 'submission')

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Load prompt template
        id: load-prompt
        run: .github/scripts/load-prompt.sh

      - name: Post OpenCode triage request
        uses: actions/github-script@v7
        env:
          PROMPT_TEMPLATE: ${{ steps.load-prompt.outputs.prompt }}
        with:
          script: |
            const postTriageComment = require('./.github/scripts/post-triage-comment.cjs');
            await postTriageComment({
              github,
              context,
              core,
              promptTemplate: process.env.PROMPT_TEMPLATE
            });
